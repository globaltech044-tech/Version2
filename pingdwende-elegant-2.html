<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>PINGDWENDE SERVICE</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 9.6px;
            -webkit-text-size-adjust: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1rem;
            background: #0f0f23;
            color: #1a1a1a;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            height: 100%;
            margin: 0;
            padding: 0;
            /* Support notch et safe area sur iPhone */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .app-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Header Ã©lÃ©gant */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            color: #1a1a1a;
            padding: 0.75rem 0.75rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            font-size: 1.25rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.75rem;
        }
        
        .logo-upload {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .logo-text {
            font-size: 1rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-stats {
            text-align: right;
            font-size: 0.75rem;
            color: #666;
        }
        
        .header-stats div {
            margin: 0.25rem 0;
        }
        
        .header-stats strong {
            font-size: 1rem;
            font-weight: 700;
            color: #667eea;
        }
        
        /* Navigation Ã©lÃ©gante */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
            box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-top: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.25rem;
            border: none;
            background: none;
            color: #999;
            font-size: 0.65rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 60%;
            height: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 0 0 2px 2px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-btn.active::before {
            transform: translateX(-50%) scaleX(1);
        }
        
        .nav-btn.active {
            color: #667eea;
        }
        
        .nav-icon {
            font-size: 1.25rem;
            margin-bottom: 0.125rem;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-btn.active .nav-icon {
            transform: scale(1.1);
        }
        
        /* Content area Ã©lÃ©gant */
        .content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 4rem 1rem 4.5rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Cards magnifiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.5), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.2);
        }
        
        .stat-card.success::before {
            background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.5), transparent);
        }
        
        .stat-card.danger::before {
            background: linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.5), transparent);
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-value.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-value.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-sub {
            font-size: 0.875rem;
            color: #999;
        }
        
        /* Formulaires Ã©lÃ©gants */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #333;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 1rem;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        /* Boutons magnifiques */
        .btn-primary {
            width: 100%;
            padding: 1.25rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 1rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            width: 100%;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 1rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            margin-top: 0.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-secondary:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }
        
        /* Liste Ã©lÃ©gante */
        .list-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.25rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .list-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.15);
        }
        
        .list-item.success { border-left-color: #10b981; }
        .list-item.danger { border-left-color: #ef4444; }
        
        .delete-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.875rem;
            margin-top: 0.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        /* FAB magnifique */
        .fab {
            position: fixed;
            bottom: 4.5rem;
            right: 1rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 1.75rem;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.5);
            z-index: 999;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.6);
        }
        
        .fab:active {
            transform: scale(0.95);
        }
        
        /* Modal Ã©lÃ©gant */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 35, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 1rem 0;
        }
        
        .modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: 2rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            margin: 0 1rem 1rem 1rem;
            border-radius: 1.5rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            max-height: 75vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .close-btn {
            background: rgba(239, 68, 68, 0.1);
            border: none;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            font-size: 1.5rem;
            color: #ef4444;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: rotate(90deg);
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            top: 4rem;
            left: 50%;
            transform: translateX(-50%) translateY(-150%);
            background: white;
            color: #1a1a1a;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .toast-icon {
            font-size: 1.25rem;
        }
        
        /* Loading animation */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 4000;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 800;
            margin: 1.5rem 0 1rem 0;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .badge {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #059669;
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }
        
        .badge-info {
            background: rgba(102, 126, 234, 0.2);
            color: #5a67d8;
        }
        
        .info-box {
            background: rgba(102, 126, 234, 0.15);
            border-left: 4px solid #667eea;
            padding: 1rem;
            border-radius: 1rem;
            margin: 1rem 0;
            font-size: 0.875rem;
        }
        
        .row-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        canvas {
            max-width: 100%;
            height: auto;
        }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }
        
        .list-title {
            font-weight: 700;
            font-size: 1.125rem;
            color: #1a1a1a;
        }
        
        .list-amount {
            font-weight: 800;
            font-size: 1.25rem;
        }
        
        .list-meta {
            font-size: 0.8125rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .row-2 {
                grid-template-columns: 1fr;
            }
            
            .stat-value {
                font-size: 1.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Loading overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loader"></div>
        </div>
        
        <!-- Toast notification -->
        <div class="toast" id="toast">
            <span class="toast-icon"></span>
            <span class="toast-message"></span>
        </div>
        
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon" id="logoContainer">
                        <span id="logoText">P</span>
                        <img id="logoImage" style="display: none;">
                        <input type="file" class="logo-upload" id="logoUpload" accept="image/*">
                    </div>
                    <div>
                        <div class="logo-text">PINGDWENDE</div>
                        <div style="font-size: 0.625rem; opacity: 0.6; font-weight: 500;">SERVICE</div>
                    </div>
                </div>
                <div class="header-stats">
                    <div>Ventes: <strong id="headerSales">0 F</strong></div>
                    <div>Profit: <strong id="headerProfit">0 F</strong></div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Dashboard -->
            <div id="dashboard" class="section active">
                <div class="stat-card success">
                    <div class="stat-label">Ventes du mois</div>
                    <div class="stat-value success" id="monthlySales">0 F</div>
                    <div class="stat-sub"><span id="salesCount">0</span> vente(s)</div>
                </div>
                
                <div class="stat-card danger">
                    <div class="stat-label">CoÃ»ts du mois</div>
                    <div class="stat-value danger" id="monthlyCosts">0 F</div>
                    <div class="stat-sub">Achats + DÃ©penses</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">BÃ©nÃ©fice Net</div>
                    <div class="stat-value" id="monthlyProfit">0 F</div>
                    <div class="stat-sub">Ce mois</div>
                </div>

                <div class="chart-container">
                    <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: 1rem; color: #1a1a1a;">Ã‰volution sur 7 jours</div>
                    <canvas id="evolutionChart"></canvas>
                </div>

                <div class="info-box">
                    <strong>ðŸ’¡ Formule :</strong> BÃ©nÃ©fice = Vente - Achat - DÃ©penses
                </div>

                <div class="section-title">RÃ©sumÃ© Global</div>
                <div class="stat-card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                        <span>Total ventes</span>
                        <strong id="totalSales" style="color: #10b981;">0 F</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                        <span>Total coÃ»ts</span>
                        <strong id="totalCosts" style="color: #ef4444;">0 F</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 0.75rem; border-top: 2px solid rgba(102, 126, 234, 0.2);">
                        <span style="font-weight: 700;">BÃ©nÃ©fice net</span>
                        <strong id="totalProfit" style="color: #667eea; font-size: 1.5rem;">0 F</strong>
                    </div>
                </div>
            </div>

            <!-- Ventes -->
            <div id="sales" class="section">
                <div class="section-title">ðŸ’° Liste des Ventes</div>
                <div id="salesList"></div>
            </div>

            <!-- DÃ©penses -->
            <div id="expenses" class="section">
                <div class="section-title">ðŸ’³ Liste des DÃ©penses</div>
                <div id="expensesList"></div>
            </div>

            <!-- Inventaire -->
            <div id="inventory" class="section">
                <div class="section-title">ðŸ“¦ Inventaire</div>
                <div class="stat-card">
                    <div class="stat-label">Valeur totale</div>
                    <div class="stat-value" id="inventoryValue">0 F</div>
                </div>
                <div id="inventoryList"></div>
            </div>

            <!-- Fin de compte -->
            <div id="daily-summary" class="section">
                <div class="section-title">ðŸ“‹ Fin de Compte - <span id="dailyDate"></span></div>
                
                <div class="stat-card success">
                    <div class="stat-label">Ventes du jour</div>
                    <div class="stat-value success" id="dailySales">0 F</div>
                    <div class="stat-sub"><span id="dailySalesCount">0</span> vente(s)</div>
                </div>
                
                <div class="stat-card danger">
                    <div class="stat-label">DÃ©penses du jour</div>
                    <div class="stat-value danger" id="dailyExpenses">0 F</div>
                    <div class="stat-sub"><span id="dailyExpensesCount">0</span> dÃ©pense(s)</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">BÃ©nÃ©fice du jour</div>
                    <div class="stat-value" id="dailyProfit">0 F</div>
                </div>

                <div class="section-title">ActivitÃ©s du jour</div>
                <div id="dailyActivities"></div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">
                <div class="nav-icon">ðŸ“Š</div>
                <div>Accueil</div>
            </button>
            <button class="nav-btn" onclick="showSection('sales')">
                <div class="nav-icon">ðŸ’°</div>
                <div>Ventes</div>
            </button>
            <button class="nav-btn" onclick="showSection('expenses')">
                <div class="nav-icon">ðŸ’³</div>
                <div>DÃ©penses</div>
            </button>
            <button class="nav-btn" onclick="showSection('inventory')">
                <div class="nav-icon">ðŸ“¦</div>
                <div>Stock</div>
            </button>
            <button class="nav-btn" onclick="showSection('daily-summary')">
                <div class="nav-icon">ðŸ“‹</div>
                <div>Fin Compte</div>
            </button>
        </div>

        <button class="fab" onclick="showAddModal()">+</button>

        <!-- Modal -->
        <div id="addModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalTitle">Ajouter</h3>
                    <button class="close-btn" onclick="closeModal()">Ã—</button>
                </div>
                
                <div class="form-group">
                    <button class="btn-secondary" onclick="setModalType('sale')">ðŸ’° Vente</button>
                    <button class="btn-secondary" onclick="setModalType('expense')">ðŸ’³ DÃ©pense</button>
                    <button class="btn-secondary" onclick="setModalType('inventory')">ðŸ“¦ Stock</button>
                </div>

                <div id="saleForm" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Article *</label>
                        <select class="form-select" id="saleInventoryItem" onchange="updateSaleFromInventory()">
                            <option value="">SÃ©lectionner...</option>
                        </select>
                    </div>
                    
                    <div class="row-2">
                        <div class="form-group">
                            <label class="form-label">Prix achat</label>
                            <input type="number" class="form-input" id="salePurchasePrice" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Prix vente *</label>
                            <input type="number" class="form-input" id="saleSalePrice" oninput="calculateSaleProfit()">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">QuantitÃ© *</label>
                        <input type="number" class="form-input" id="saleQuantity" value="1" oninput="calculateSaleProfit()">
                    </div>
                    
                    <div class="info-box">
                        <strong>ðŸ’° BÃ©nÃ©fice :</strong> <span id="estimatedProfit">0 F</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Client</label>
                        <input type="text" class="form-input" id="saleCustomer" placeholder="Nom (optionnel)">
                    </div>
                    
                    <button class="btn-primary" onclick="addSale()">âœ“ Enregistrer la vente</button>
                </div>

                <div id="expenseForm" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <input type="text" class="form-input" id="expenseDesc" placeholder="Ex: Loyer du mois">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">CatÃ©gorie *</label>
                        <select class="form-select" id="expenseCategory">
                            <option value="">SÃ©lectionner...</option>
                            <option value="Loyer">Loyer</option>
                            <option value="Ã‰lectricitÃ©">Ã‰lectricitÃ©</option>
                            <option value="Salaires">Salaires</option>
                            <option value="Transport">Transport</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Montant (F CFA) *</label>
                        <input type="number" class="form-input" id="expenseAmount" placeholder="0">
                    </div>
                    
                    <button class="btn-primary" onclick="addExpense()">âœ“ Enregistrer la dÃ©pense</button>
                </div>

                <div id="inventoryForm" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Nom de l'article *</label>
                        <input type="text" class="form-input" id="invName" placeholder="Ex: Plaquettes de frein">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Type *</label>
                        <select class="form-select" id="invType">
                            <option value="">SÃ©lectionner...</option>
                            <option value="PiÃ¨ce auto">PiÃ¨ce auto</option>
                            <option value="PiÃ¨ce moto">PiÃ¨ce moto</option>
                            <option value="Peinture">Peinture</option>
                            <option value="Accessoire">Accessoire</option>
                        </select>
                    </div>
                    
                    <div class="row-2">
                        <div class="form-group">
                            <label class="form-label">QuantitÃ© *</label>
                            <input type="number" class="form-input" id="invQuantity" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Prix achat *</label>
                            <input type="number" class="form-input" id="invPurchasePrice" placeholder="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Prix vente suggÃ©rÃ©</label>
                        <input type="number" class="form-input" id="invSuggestedPrice" placeholder="0">
                    </div>
                    
                    <button class="btn-primary" onclick="addInventoryItem()">âœ“ Ajouter au stock</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        let data = {
            sales: [],
            expenses: [],
            inventory: [],
            logo: null
        };

        let evolutionChart = null;

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = toast.querySelector('.toast-icon');
            const msgEl = toast.querySelector('.toast-message');
            
            // Annuler le timeout prÃ©cÃ©dent si existe
            if (window.toastTimeout) {
                clearTimeout(window.toastTimeout);
            }
            
            toast.className = 'toast ' + type;
            icon.textContent = type === 'success' ? 'âœ“' : 'âœ—';
            msgEl.textContent = message;
            
            toast.classList.add('show');
            
            window.toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Loading overlay
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function loadData() {
            const saved = localStorage.getItem('pingdwende_data');
            if (saved) {
                try {
                    data = JSON.parse(saved);
                    if (data.logo) {
                        document.getElementById('logoImage').src = data.logo;
                        document.getElementById('logoImage').style.display = 'block';
                        document.getElementById('logoText').style.display = 'none';
                    }
                } catch(e) {
                    console.error('Erreur chargement:', e);
                }
            }
            
            // Ensure arrays exist
            if (!data.sales) data.sales = [];
            if (!data.expenses) data.expenses = [];
            if (!data.inventory) data.inventory = [];
            
            updateAllViews();
        }

        function updateAllViews() {
            updateDashboard();
            renderSales();
            renderExpenses();
            renderInventory();
            updateInventorySelect();
            updateEvolutionChart();
            updateDailySummary();
        }

        function saveData() {
            try {
                localStorage.setItem('pingdwende_data', JSON.stringify(data));
                console.log('DonnÃ©es sauvegardÃ©es:', data);
                return true;
            } catch(e) {
                console.error('Erreur sauvegarde:', e);
                showToast('Erreur lors de la sauvegarde', 'error');
                return false;
            }
        }

        document.getElementById('logoUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    data.logo = event.target.result;
                    document.getElementById('logoImage').src = data.logo;
                    document.getElementById('logoImage').style.display = 'block';
                    document.getElementById('logoText').style.display = 'none';
                    saveData();
                    showToast('Logo mis Ã  jour !');
                };
                reader.readAsDataURL(file);
            }
        });

        function formatCurrency(amount) {
            return Math.round(parseFloat(amount || 0)).toLocaleString('fr-FR') + ' F';
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.closest('.nav-btn').classList.add('active');
            
            if (sectionId === 'daily-summary') {
                updateDailySummary();
            }
        }

        let currentModalType = 'sale';

        function showAddModal() {
            document.getElementById('addModal').classList.add('active');
            setModalType('sale');
        }

        function closeModal() {
            document.getElementById('addModal').classList.remove('active');
            clearForms();
        }

        function setModalType(type) {
            currentModalType = type;
            
            document.getElementById('saleForm').style.display = 'none';
            document.getElementById('expenseForm').style.display = 'none';
            document.getElementById('inventoryForm').style.display = 'none';
            
            if (type === 'sale') {
                document.getElementById('modalTitle').textContent = 'Nouvelle Vente';
                document.getElementById('saleForm').style.display = 'block';
                updateInventorySelect();
            } else if (type === 'expense') {
                document.getElementById('modalTitle').textContent = 'Nouvelle DÃ©pense';
                document.getElementById('expenseForm').style.display = 'block';
            } else if (type === 'inventory') {
                document.getElementById('modalTitle').textContent = 'Ajouter au Stock';
                document.getElementById('inventoryForm').style.display = 'block';
            }
        }

        function clearForms() {
            document.getElementById('saleInventoryItem').value = '';
            document.getElementById('salePurchasePrice').value = '';
            document.getElementById('saleSalePrice').value = '';
            document.getElementById('saleQuantity').value = '1';
            document.getElementById('saleCustomer').value = '';
            
            document.getElementById('expenseDesc').value = '';
            document.getElementById('expenseCategory').value = '';
            document.getElementById('expenseAmount').value = '';
            
            document.getElementById('invName').value = '';
            document.getElementById('invType').value = '';
            document.getElementById('invQuantity').value = '';
            document.getElementById('invPurchasePrice').value = '';
            document.getElementById('invSuggestedPrice').value = '';
        }

        function updateInventorySelect() {
            const select = document.getElementById('saleInventoryItem');
            select.innerHTML = '<option value="">SÃ©lectionner un article...</option>';
            
            if (data.inventory && data.inventory.length > 0) {
                data.inventory.forEach(item => {
                    if (item.quantity > 0) {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = `${item.name} (${item.quantity} dispo - ${formatCurrency(item.purchasePrice)})`;
                        select.appendChild(option);
                    }
                });
            }
        }

        function updateSaleFromInventory() {
            const itemId = document.getElementById('saleInventoryItem').value;
            if (!itemId) {
                document.getElementById('salePurchasePrice').value = '';
                document.getElementById('saleSalePrice').value = '';
                return;
            }
            
            const item = data.inventory.find(i => i.id == itemId);
            if (item) {
                document.getElementById('salePurchasePrice').value = item.purchasePrice;
                document.getElementById('saleSalePrice').value = item.suggestedPrice || '';
                calculateSaleProfit();
            }
        }

        function calculateSaleProfit() {
            const purchasePrice = parseFloat(document.getElementById('salePurchasePrice').value || 0);
            const salePrice = parseFloat(document.getElementById('saleSalePrice').value || 0);
            const quantity = parseInt(document.getElementById('saleQuantity').value || 1);
            
            const profit = (salePrice - purchasePrice) * quantity;
            document.getElementById('estimatedProfit').textContent = formatCurrency(profit);
        }

        function addSale() {
            showLoading();
            
            setTimeout(() => {
                const itemId = document.getElementById('saleInventoryItem').value;
                const salePrice = parseFloat(document.getElementById('saleSalePrice').value);
                const quantity = parseInt(document.getElementById('saleQuantity').value || 1);
                const customer = document.getElementById('saleCustomer').value || 'Anonyme';
                
                if (!itemId || !salePrice || salePrice <= 0) {
                    hideLoading();
                    showToast('Veuillez remplir tous les champs obligatoires', 'error');
                    return;
                }
                
                const item = data.inventory.find(i => i.id == itemId);
                if (!item || item.quantity < quantity) {
                    hideLoading();
                    showToast('Stock insuffisant !', 'error');
                    return;
                }
                
                const purchasePrice = item.purchasePrice;
                const profit = (salePrice - purchasePrice) * quantity;
                
                const newSale = {
                    id: Date.now(),
                    itemId: item.id,
                    itemName: item.name,
                    category: item.type,
                    purchasePrice,
                    salePrice,
                    quantity,
                    profit,
                    customer,
                    date: new Date().toISOString()
                };
                
                data.sales.push(newSale);
                item.quantity -= quantity;
                
                if (saveData()) {
                    hideLoading();
                    closeModal();
                    updateAllViews();
                    showToast('âœ“ Vente enregistrÃ©e avec succÃ¨s !');
                } else {
                    hideLoading();
                    showToast('Erreur lors de l\'enregistrement', 'error');
                }
            }, 300);
        }

        function addExpense() {
            showLoading();
            
            setTimeout(() => {
                const desc = document.getElementById('expenseDesc').value;
                const category = document.getElementById('expenseCategory').value;
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                
                if (!desc || !category || !amount || amount <= 0) {
                    hideLoading();
                    showToast('Veuillez remplir tous les champs obligatoires', 'error');
                    return;
                }
                
                const newExpense = {
                    id: Date.now(),
                    description: desc,
                    category,
                    amount,
                    date: new Date().toISOString()
                };
                
                data.expenses.push(newExpense);
                
                if (saveData()) {
                    hideLoading();
                    closeModal();
                    updateAllViews();
                    showToast('âœ“ DÃ©pense enregistrÃ©e avec succÃ¨s !');
                } else {
                    hideLoading();
                    showToast('Erreur lors de l\'enregistrement', 'error');
                }
            }, 300);
        }

        function addInventoryItem() {
            showLoading();
            
            setTimeout(() => {
                const name = document.getElementById('invName').value;
                const type = document.getElementById('invType').value;
                const quantity = parseInt(document.getElementById('invQuantity').value);
                const purchasePrice = parseFloat(document.getElementById('invPurchasePrice').value);
                const suggestedPrice = parseFloat(document.getElementById('invSuggestedPrice').value) || purchasePrice * 1.3;
                
                if (!name || !type || !quantity || quantity < 0 || !purchasePrice || purchasePrice <= 0) {
                    hideLoading();
                    showToast('Veuillez remplir tous les champs obligatoires', 'error');
                    return;
                }
                
                const newItem = {
                    id: Date.now(),
                    name,
                    type,
                    quantity,
                    purchasePrice,
                    suggestedPrice,
                    date: new Date().toISOString()
                };
                
                data.inventory.push(newItem);
                
                if (saveData()) {
                    hideLoading();
                    closeModal();
                    updateAllViews();
                    showToast('âœ“ Article ajoutÃ© au stock avec succÃ¨s !');
                } else {
                    hideLoading();
                    showToast('Erreur lors de l\'enregistrement', 'error');
                }
            }, 300);
        }

        function deleteSale(id) {
            if (confirm('Supprimer cette vente ? Le stock ne sera PAS restaurÃ©.')) {
                data.sales = data.sales.filter(s => s.id !== id);
                saveData();
                updateAllViews();
                showToast('Vente supprimÃ©e');
            }
        }

        function deleteExpense(id) {
            if (confirm('Supprimer cette dÃ©pense ?')) {
                data.expenses = data.expenses.filter(e => e.id !== id);
                saveData();
                updateAllViews();
                showToast('DÃ©pense supprimÃ©e');
            }
        }

        function deleteInventoryItem(id) {
            if (confirm('Supprimer cet article ?')) {
                data.inventory = data.inventory.filter(i => i.id !== id);
                saveData();
                updateAllViews();
                showToast('Article supprimÃ©');
            }
        }

        function updateDashboard() {
            const totalSalesRevenue = (data.sales || []).reduce((sum, s) => sum + (s.salePrice * s.quantity), 0);
            const totalPurchaseCosts = (data.sales || []).reduce((sum, s) => sum + (s.purchasePrice * s.quantity), 0);
            const totalExpenses = (data.expenses || []).reduce((sum, e) => sum + e.amount, 0);
            const totalProfit = totalSalesRevenue - totalPurchaseCosts - totalExpenses;
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthlySalesRevenue = (data.sales || []).filter(s => {
                const d = new Date(s.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).reduce((sum, s) => sum + (s.salePrice * s.quantity), 0);
            
            const monthlyPurchaseCosts = (data.sales || []).filter(s => {
                const d = new Date(s.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).reduce((sum, s) => sum + (s.purchasePrice * s.quantity), 0);
            
            const monthlyExpenses = (data.expenses || []).filter(e => {
                const d = new Date(e.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).reduce((sum, e) => sum + e.amount, 0);
            
            const monthlyCosts = monthlyPurchaseCosts + monthlyExpenses;
            const monthlyProfit = monthlySalesRevenue - monthlyCosts;
            
            document.getElementById('headerSales').textContent = formatCurrency(totalSalesRevenue);
            document.getElementById('headerProfit').textContent = formatCurrency(totalProfit);
            
            document.getElementById('monthlySales').textContent = formatCurrency(monthlySalesRevenue);
            document.getElementById('monthlyCosts').textContent = formatCurrency(monthlyCosts);
            document.getElementById('monthlyProfit').textContent = formatCurrency(monthlyProfit);
            
            document.getElementById('salesCount').textContent = (data.sales || []).filter(s => {
                const d = new Date(s.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).length;
            
            document.getElementById('totalSales').textContent = formatCurrency(totalSalesRevenue);
            document.getElementById('totalCosts').textContent = formatCurrency(totalPurchaseCosts + totalExpenses);
            document.getElementById('totalProfit').textContent = formatCurrency(totalProfit);
        }

        function renderSales() {
            const list = document.getElementById('salesList');
            
            if (!data.sales || data.sales.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">ðŸ’°</div><div>Aucune vente enregistrÃ©e</div><div style="font-size: 0.875rem; margin-top: 0.5rem; opacity: 0.7;">Cliquez sur + pour ajouter une vente</div></div>';
                return;
            }
            
            const sorted = [...data.sales].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            list.innerHTML = sorted.map(sale => `
                <div class="list-item ${sale.profit >= 0 ? 'success' : 'danger'}">
                    <div class="list-header">
                        <div>
                            <div class="list-title">${sale.itemName}</div>
                            <div class="list-meta">
                                ${formatDate(sale.date)}<br>
                                ðŸ‘¤ ${sale.customer} â€¢ QtÃ©: ${sale.quantity}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="list-amount" style="color: #10b981;">${formatCurrency(sale.salePrice * sale.quantity)}</div>
                        </div>
                    </div>
                    <div style="margin-top: 0.75rem;">
                        <span class="badge badge-info">Achat: ${formatCurrency(sale.purchasePrice)}</span>
                        <span class="badge badge-success">Vente: ${formatCurrency(sale.salePrice)}</span>
                        <span class="badge ${sale.profit >= 0 ? 'badge-success' : 'badge-danger'}">Profit: ${formatCurrency(sale.profit)}</span>
                    </div>
                    <button class="delete-btn" onclick="deleteSale(${sale.id})">ðŸ—‘ï¸ Supprimer</button>
                </div>
            `).join('');
        }

        function renderExpenses() {
            const list = document.getElementById('expensesList');
            
            if (!data.expenses || data.expenses.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">ðŸ’³</div><div>Aucune dÃ©pense enregistrÃ©e</div><div style="font-size: 0.875rem; margin-top: 0.5rem; opacity: 0.7;">Cliquez sur + pour ajouter une dÃ©pense</div></div>';
                return;
            }
            
            const sorted = [...data.expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            list.innerHTML = sorted.map(expense => `
                <div class="list-item danger">
                    <div class="list-header">
                        <div>
                            <div class="list-title">${expense.description}</div>
                            <div class="list-meta">
                                ${formatDate(expense.date)}<br>
                                <span class="badge badge-danger">${expense.category}</span>
                            </div>
                        </div>
                        <div class="list-amount" style="color: #ef4444;">${formatCurrency(expense.amount)}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteExpense(${expense.id})">ðŸ—‘ï¸ Supprimer</button>
                </div>
            `).join('');
        }

        function renderInventory() {
            const list = document.getElementById('inventoryList');
            const totalValue = (data.inventory || []).reduce((sum, item) => sum + (item.quantity * item.purchasePrice), 0);
            
            document.getElementById('inventoryValue').textContent = formatCurrency(totalValue);
            
            if (!data.inventory || data.inventory.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">ðŸ“¦</div><div>Aucun article dans le stock</div><div style="font-size: 0.875rem; margin-top: 0.5rem; opacity: 0.7;">Cliquez sur + pour ajouter un article</div></div>';
                return;
            }
            
            list.innerHTML = data.inventory.map(item => {
                const badgeClass = item.quantity === 0 ? 'badge-danger' : item.quantity <= 5 ? 'badge-danger' : 'badge-success';
                const status = item.quantity === 0 ? 'âŒ Rupture' : item.quantity <= 5 ? 'âš ï¸ Stock bas' : 'âœ“ En stock';
                
                return `
                    <div class="list-item">
                        <div class="list-header">
                            <div>
                                <div class="list-title">${item.name}</div>
                                <div class="list-meta">
                                    <span class="badge ${badgeClass}">${status}</span>
                                    <span class="badge badge-info">${item.type}</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 0.75rem; font-size: 0.875rem; color: #666;">
                            <strong style="color: #667eea;">QtÃ©: ${item.quantity}</strong> â€¢ 
                            Achat: ${formatCurrency(item.purchasePrice)} â€¢ 
                            Vente: ${formatCurrency(item.suggestedPrice)}
                        </div>
                        <button class="delete-btn" onclick="deleteInventoryItem(${item.id})">ðŸ—‘ï¸ Supprimer</button>
                    </div>
                `;
            }).join('');
        }

        function updateEvolutionChart() {
            const ctx = document.getElementById('evolutionChart');
            if (!ctx) return;
            
            const last7Days = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last7Days.push(date);
            }
            
            const salesByDay = last7Days.map(date => {
                const dayStr = date.toISOString().split('T')[0];
                return (data.sales || [])
                    .filter(s => s.date.split('T')[0] === dayStr)
                    .reduce((sum, s) => sum + (s.salePrice * s.quantity), 0);
            });
            
            const expensesByDay = last7Days.map(date => {
                const dayStr = date.toISOString().split('T')[0];
                return (data.expenses || [])
                    .filter(e => e.date.split('T')[0] === dayStr)
                    .reduce((sum, e) => sum + e.amount, 0);
            });
            
            if (evolutionChart) {
                evolutionChart.destroy();
            }
            
            evolutionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days.map(d => d.getDate() + '/' + (d.getMonth() + 1)),
                    datasets: [{
                        label: 'Ventes',
                        data: salesByDay,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'DÃ©penses',
                        data: expensesByDay,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateDailySummary() {
            const today = new Date();
            document.getElementById('dailyDate').textContent = today.toLocaleDateString('fr-FR', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            const todayStr = today.toISOString().split('T')[0];
            
            const todaySales = (data.sales || []).filter(s => s.date.split('T')[0] === todayStr);
            const todayExpenses = (data.expenses || []).filter(e => e.date.split('T')[0] === todayStr);
            
            const dailySalesAmount = todaySales.reduce((sum, s) => sum + (s.salePrice * s.quantity), 0);
            const dailyPurchaseCosts = todaySales.reduce((sum, s) => sum + (s.purchasePrice * s.quantity), 0);
            const dailyExpensesAmount = todayExpenses.reduce((sum, e) => sum + e.amount, 0);
            const dailyProfitAmount = dailySalesAmount - dailyPurchaseCosts - dailyExpensesAmount;
            
            document.getElementById('dailySales').textContent = formatCurrency(dailySalesAmount);
            document.getElementById('dailySalesCount').textContent = todaySales.length;
            document.getElementById('dailyExpenses').textContent = formatCurrency(dailyExpensesAmount);
            document.getElementById('dailyExpensesCount').textContent = todayExpenses.length;
            document.getElementById('dailyProfit').textContent = formatCurrency(dailyProfitAmount);
            
            const activities = [];
            todaySales.forEach(s => activities.push({...s, type: 'sale'}));
            todayExpenses.forEach(e => activities.push({...e, type: 'expense'}));
            activities.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const activitiesList = document.getElementById('dailyActivities');
            if (activities.length === 0) {
                activitiesList.innerHTML = '<div class="empty-state"><div class="empty-icon">ðŸ“‹</div><div>Aucune activitÃ© aujourd\'hui</div></div>';
            } else {
                activitiesList.innerHTML = activities.map(activity => {
                    if (activity.type === 'sale') {
                        return `
                            <div class="list-item success">
                                <div class="list-header">
                                    <div>
                                        <div class="list-title">ðŸ’° Vente: ${activity.itemName}</div>
                                        <div class="list-meta">${formatDate(activity.date)} â€¢ ${activity.customer}</div>
                                    </div>
                                    <div class="list-amount" style="color: #10b981;">${formatCurrency(activity.salePrice * activity.quantity)}</div>
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="list-item danger">
                                <div class="list-header">
                                    <div>
                                        <div class="list-title">ðŸ’³ DÃ©pense: ${activity.description}</div>
                                        <div class="list-meta">${formatDate(activity.date)}</div>
                                    </div>
                                    <div class="list-amount" style="color: #ef4444;">${formatCurrency(activity.amount)}</div>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            }
        }

        document.getElementById('addModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize
        loadData();
    </script>
</body>
</html>
